<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üèì Ping Pong - –£—á–µ–±–Ω–∞—è –∏–≥—Ä–∞</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Arial", sans-serif;
        background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        overflow: hidden;
      }

      .game-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        background: rgba(255, 255, 255, 0.05);
        padding: 30px;
        border-radius: 20px;
        backdrop-filter: blur(10px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      }

      h1 {
        color: #ecf0f1;
        font-size: 2.5rem;
        margin-bottom: 20px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
      }

      canvas {
        border: 3px solid #ecf0f1;
        border-radius: 10px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
        background: #1a1a1a;
      }

      .controls {
        margin-top: 20px;
        text-align: center;
        color: #ecf0f1;
        background: rgba(255, 255, 255, 0.1);
        padding: 15px 25px;
        border-radius: 15px;
        backdrop-filter: blur(5px);
      }

      .controls p {
        margin: 5px 0;
        font-weight: bold;
      }

      .score-display {
        position: absolute;
        top: 40px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 2rem;
        font-weight: bold;
        color: #ecf0f1;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
        background: rgba(52, 73, 94, 0.8);
        padding: 15px 30px;
        border-radius: 25px;
        backdrop-filter: blur(10px);
      }

      .game-over {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(52, 73, 94, 0.95);
        color: #ecf0f1;
        padding: 40px;
        border-radius: 20px;
        text-align: center;
        display: none;
        backdrop-filter: blur(10px);
        border: 2px solid #3498db;
      }

      .start-screen {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(52, 73, 94, 0.95);
        color: #ecf0f1;
        padding: 40px;
        border-radius: 20px;
        text-align: center;
        backdrop-filter: blur(10px);
        border: 2px solid #3498db;
        max-width: 600px;
      }

      .difficulty-selection {
        margin: 20px 0;
      }

      .difficulty-btn {
        background: linear-gradient(45deg, #3498db, #2980b9);
        color: #ecf0f1;
        border: none;
        padding: 12px 25px;
        border-radius: 25px;
        font-size: 1rem;
        font-weight: bold;
        cursor: pointer;
        margin: 0 10px;
        transition: all 0.3s ease;
      }

      .difficulty-btn:hover {
        background: linear-gradient(45deg, #2980b9, #21618c);
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
      }

      .difficulty-btn.selected {
        background: linear-gradient(45deg, #e74c3c, #c0392b);
        box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
      }

      .btn {
        background: linear-gradient(45deg, #27ae60, #229954);
        color: #ecf0f1;
        border: none;
        padding: 15px 30px;
        border-radius: 25px;
        font-size: 1.1rem;
        font-weight: bold;
        cursor: pointer;
        margin: 10px;
        transition: all 0.3s ease;
      }

      .btn:hover {
        background: linear-gradient(45deg, #229954, #1e8449);
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
      }

      .back-button {
        position: absolute;
        top: 20px;
        left: 20px;
        background: rgba(255, 255, 255, 0.1);
        color: #ecf0f1;
        border: 1px solid rgba(255, 255, 255, 0.3);
        padding: 10px 20px;
        border-radius: 20px;
        font-weight: bold;
        cursor: pointer;
        text-decoration: none;
        transition: all 0.3s ease;
      }

      .back-button:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: scale(1.05);
      }

      .game-info {
        color: #bdc3c7;
        font-size: 0.9rem;
        margin-top: 15px;
        line-height: 1.4;
      }

      .power-ups {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        color: #ecf0f1;
        text-align: center;
        background: rgba(0, 0, 0, 0.3);
        padding: 10px 20px;
        border-radius: 15px;
      }

      @media (max-width: 768px) {
        canvas {
          width: 90vw;
          height: 60vh;
        }

        h1 {
          font-size: 2rem;
        }

        .game-container {
          padding: 20px;
        }

        .difficulty-btn {
          display: block;
          margin: 5px auto;
          width: 200px;
        }
      }

      .particle {
        position: absolute;
        width: 4px;
        height: 4px;
        background: #3498db;
        border-radius: 50%;
        pointer-events: none;
      }
    </style>
  </head>
  <body>
    <a href="../index.html" class="back-button">‚Üê –ö —É—Ä–æ–∫–∞–º</a>

    <div class="score-display" id="score">–ò–≥—Ä–æ–∫: 0 | –ò–ò: 0</div>

    <div class="game-container">
      <h1>üèì Ping Pong Championship</h1>
      <canvas id="gameCanvas" width="800" height="400"></canvas>

      <div class="controls">
        <p>üñ±Ô∏è –ú—ã—à—å - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∫–µ—Ç–∫–æ–π | –ü—Ä–æ–±–µ–ª - –ø–∞—É–∑–∞</p>
        <p>üéØ –ü–µ—Ä–≤—ã–π –¥–æ 11 –æ—á–∫–æ–≤ –ø–æ–±–µ–∂–¥–∞–µ—Ç!</p>
      </div>
    </div>

    <div class="power-ups" id="powerUps" style="display: none">
      –ê–∫—Ç–∏–≤–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã: <span id="activeEffects"></span>
    </div>

    <!-- –≠–∫—Ä–∞–Ω —Å—Ç–∞—Ä—Ç–∞ -->
    <div class="start-screen" id="startScreen">
      <h2>üèì –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Ping Pong!</h2>
      <p>–°—Ä–∞–∑–∏—Ç–µ—Å—å —Å –ò–ò –≤ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–π –∏–≥—Ä–µ –ø–∏–Ω–≥-–ø–æ–Ω–≥</p>

      <div class="difficulty-selection">
        <h3>–í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –ò–ò:</h3>
        <button
          class="difficulty-btn selected"
          onclick="selectDifficulty('easy')"
        >
          üôÇ –õ–µ–≥–∫–æ
        </button>
        <button class="difficulty-btn" onclick="selectDifficulty('medium')">
          üòê –°—Ä–µ–¥–Ω–µ
        </button>
        <button class="difficulty-btn" onclick="selectDifficulty('hard')">
          üò§ –°–ª–æ–∂–Ω–æ
        </button>
      </div>

      <button class="btn" onclick="startGame()">üöÄ –ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>

      <div class="game-info">
        <p><strong>üéì –£—á–µ–±–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:</strong></p>
        <p>‚Ä¢ –í–µ–∫—Ç–æ—Ä–Ω–∞—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –∏ —Ñ–∏–∑–∏–∫–∞ –æ—Ç—Ä–∞–∂–µ–Ω–∏–π</p>
        <p>‚Ä¢ –ò–ò —Å —Ä–∞–∑–Ω—ã–º–∏ —É—Ä–æ–≤–Ω—è–º–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏</p>
        <p>‚Ä¢ –°–∏—Å—Ç–µ–º–∞ —á–∞—Å—Ç–∏—Ü –∏ –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã</p>
        <p>‚Ä¢ –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π –∏ –∏–≥—Ä–æ–≤–∞—è –ª–æ–≥–∏–∫–∞</p>
      </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã -->
    <div class="game-over" id="gameOver">
      <h2 id="gameResult">üèÜ –ü–æ–±–µ–¥–∞!</h2>
      <p id="finalScore">–§–∏–Ω–∞–ª—å–Ω—ã–π —Å—á—ë—Ç: 11-8</p>
      <p id="gameStats">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä—ã</p>
      <button class="btn" onclick="restartGame()">üîÑ –ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
      <button class="btn" onclick="showStartScreen()">üè† –í –º–µ–Ω—é</button>
    </div>

    <script>
      // ===========================================
      // –ö–û–ù–°–¢–ê–ù–¢–´ –ò –ù–ê–°–¢–†–û–ô–ö–ò –ò–ì–†–´
      // ===========================================

      const canvas = document.getElementById("gameCanvas");
      const ctx = canvas.getContext("2d");

      // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –ò–ò
      const AI_DIFFICULTY = {
        easy: {
          speed: 0.03, // –ú–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è
          accuracy: 0.7, // 70% —Ç–æ—á–Ω–æ—Å—Ç—å
          prediction: 0.1, // –°–ª–∞–±–æ–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ
          maxSpeed: 4, // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏
          reactionDelay: 0.3, // –ó–∞–¥–µ—Ä–∂–∫–∞ —Ä–µ–∞–∫—Ü–∏–∏
        },
        medium: {
          speed: 0.05,
          accuracy: 0.85,
          prediction: 0.3,
          maxSpeed: 6,
          reactionDelay: 0.2,
        },
        hard: {
          speed: 0.07,
          accuracy: 0.95,
          prediction: 0.5,
          maxSpeed: 8,
          reactionDelay: 0.1,
        },
      };

      // –§–∏–∑–∏—á–µ—Å–∫–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
      const BALL_SPEED = 5;
      const BALL_RADIUS = 8;
      const PADDLE_WIDTH = 12;
      const PADDLE_HEIGHT = 80;
      const PADDLE_SPEED = 7;
      const MAX_ANGLE = Math.PI / 4; // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É–≥–æ–ª –æ—Ç—Ä–∞–∂–µ–Ω–∏—è (45¬∞)

      // ===========================================
      // –ò–ì–†–û–í–´–ï –û–ë–™–ï–ö–¢–´
      // ===========================================

      // –ú—è—á
      const ball = {
        x: canvas.width / 2,
        y: canvas.height / 2,
        velocityX: BALL_SPEED,
        velocityY: 0,
        radius: BALL_RADIUS,
        trail: [], // –°–ª–µ–¥ –º—è—á–∞

        update: function () {
          this.x += this.velocityX;
          this.y += this.velocityY;

          // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–∑–∏—Ü–∏—é –¥–ª—è —Å–ª–µ–¥–∞
          this.trail.unshift({ x: this.x, y: this.y });
          if (this.trail.length > 10) this.trail.pop();

          // –û—Ç—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç –≤–µ—Ä—Ö–Ω–µ–π –∏ –Ω–∏–∂–Ω–µ–π —Å—Ç–µ–Ω–∫–∏
          if (this.y <= this.radius || this.y >= canvas.height - this.radius) {
            this.velocityY = -this.velocityY;
            createImpactEffect(this.x, this.y);
            playHitSound();
          }

          // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—á–∫–æ–≤
          if (this.x <= 0) {
            aiScore++;
            this.reset();
            updateScore();
            playScoreSound();
          } else if (this.x >= canvas.width) {
            playerScore++;
            this.reset();
            updateScore();
            playScoreSound();
          }
        },

        reset: function () {
          this.x = canvas.width / 2;
          this.y = canvas.height / 2;
          this.velocityX = (Math.random() > 0.5 ? 1 : -1) * BALL_SPEED;
          this.velocityY = (Math.random() - 0.5) * 4;
          this.trail = [];
        },

        draw: function () {
          // –†–∏—Å—É–µ–º —Å–ª–µ–¥
          ctx.globalAlpha = 0.3;
          this.trail.forEach((pos, index) => {
            ctx.globalAlpha = 0.3 * (1 - index / this.trail.length);
            ctx.fillStyle = "#3498DB";
            ctx.beginPath();
            ctx.arc(
              pos.x,
              pos.y,
              this.radius * (1 - index / this.trail.length),
              0,
              Math.PI * 2
            );
            ctx.fill();
          });

          // –†–∏—Å—É–µ–º –º—è—á
          ctx.globalAlpha = 1;
          const gradient = ctx.createRadialGradient(
            this.x - 3,
            this.y - 3,
            0,
            this.x,
            this.y,
            this.radius
          );
          gradient.addColorStop(0, "#FFFFFF");
          gradient.addColorStop(0.7, "#ECF0F1");
          gradient.addColorStop(1, "#BDC3C7");

          ctx.fillStyle = gradient;
          ctx.beginPath();
          ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
          ctx.fill();

          // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ —Å–≤–µ—Ç–∞
          ctx.fillStyle = "rgba(255, 255, 255, 0.6)";
          ctx.beginPath();
          ctx.arc(this.x - 2, this.y - 2, this.radius * 0.3, 0, Math.PI * 2);
          ctx.fill();
        },
      };

      // –ò–≥—Ä–æ–∫ (–ª–µ–≤–∞—è —Ä–∞–∫–µ—Ç–∫–∞)
      const player = {
        x: 30,
        y: canvas.height / 2 - PADDLE_HEIGHT / 2,
        width: PADDLE_WIDTH,
        height: PADDLE_HEIGHT,
        targetY: canvas.height / 2 - PADDLE_HEIGHT / 2,

        update: function () {
          // –ü–ª–∞–≤–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –∫ —Ü–µ–ª–µ–≤–æ–π –ø–æ–∑–∏—Ü–∏–∏
          const diff = this.targetY - this.y;
          this.y += diff * 0.2;

          // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –≥—Ä–∞–Ω–∏—Ü–∞–º
          if (this.y < 0) this.y = 0;
          if (this.y > canvas.height - this.height) {
            this.y = canvas.height - this.height;
          }
        },

        draw: function () {
          // –û—Å–Ω–æ–≤–Ω–∞—è —Ä–∞–∫–µ—Ç–∫–∞
          const gradient = ctx.createLinearGradient(
            this.x,
            0,
            this.x + this.width,
            0
          );
          gradient.addColorStop(0, "#3498DB");
          gradient.addColorStop(0.5, "#2980B9");
          gradient.addColorStop(1, "#21618C");

          ctx.fillStyle = gradient;
          ctx.fillRect(this.x, this.y, this.width, this.height);

          // –ë–ª–∏–∫
          ctx.fillStyle = "rgba(255, 255, 255, 0.3)";
          ctx.fillRect(this.x + 2, this.y + 2, this.width - 4, this.height / 3);
        },
      };

      // –ò–ò (–ø—Ä–∞–≤–∞—è —Ä–∞–∫–µ—Ç–∫–∞)
      const ai = {
        x: canvas.width - 30 - PADDLE_WIDTH,
        y: canvas.height / 2 - PADDLE_HEIGHT / 2,
        width: PADDLE_WIDTH,
        height: PADDLE_HEIGHT,
        targetY: canvas.height / 2 - PADDLE_HEIGHT / 2,
        difficulty: "easy",
        reactionTime: 0,

        update: function () {
          const settings = AI_DIFFICULTY[this.difficulty];
          this.reactionTime += 0.016; // ~60 FPS

          // –ò–ò —Ä–µ–∞–≥–∏—Ä—É–µ—Ç —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
          if (this.reactionTime >= settings.reactionDelay) {
            // –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –º—è—á–∞
            let predictedY = ball.y;
            if (ball.velocityX > 0 && ball.x > canvas.width / 2) {
              const timeToReach = (this.x - ball.x) / ball.velocityX;
              predictedY =
                ball.y + ball.velocityY * timeToReach * settings.prediction;
            }

            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ—Ç–æ—á–Ω–æ—Å—Ç—å
            const error =
              (Math.random() - 0.5) * PADDLE_HEIGHT * (1 - settings.accuracy);
            this.targetY = predictedY - this.height / 2 + error;

            this.reactionTime = 0;
          }

          // –î–≤–∏–∂–µ–Ω–∏–µ –ò–ò
          const diff = this.targetY - this.y;
          const moveSpeed = Math.min(
            Math.abs(diff) * settings.speed,
            settings.maxSpeed
          );
          this.y += Math.sign(diff) * moveSpeed;

          // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
          if (this.y < 0) this.y = 0;
          if (this.y > canvas.height - this.height) {
            this.y = canvas.height - this.height;
          }
        },

        draw: function () {
          // –û—Å–Ω–æ–≤–Ω–∞—è —Ä–∞–∫–µ—Ç–∫–∞
          const gradient = ctx.createLinearGradient(
            this.x,
            0,
            this.x + this.width,
            0
          );
          gradient.addColorStop(0, "#E74C3C");
          gradient.addColorStop(0.5, "#C0392B");
          gradient.addColorStop(1, "#A93226");

          ctx.fillStyle = gradient;
          ctx.fillRect(this.x, this.y, this.width, this.height);

          // –ë–ª–∏–∫
          ctx.fillStyle = "rgba(255, 255, 255, 0.3)";
          ctx.fillRect(this.x + 2, this.y + 2, this.width - 4, this.height / 3);
        },
      };

      // ===========================================
      // –°–ò–°–¢–ï–ú–ê –ß–ê–°–¢–ò–¶ –ò –≠–§–§–ï–ö–¢–û–í
      // ===========================================

      let particles = [];

      function createImpactEffect(x, y) {
        for (let i = 0; i < 8; i++) {
          particles.push({
            x: x,
            y: y,
            velocityX: (Math.random() - 0.5) * 10,
            velocityY: (Math.random() - 0.5) * 10,
            life: 1.0,
            decay: 0.02,
            size: Math.random() * 4 + 2,
            color: `hsl(${Math.random() * 60 + 200}, 100%, ${
              Math.random() * 30 + 60
            }%)`,
          });
        }
      }

      function updateParticles() {
        for (let i = particles.length - 1; i >= 0; i--) {
          const p = particles[i];
          p.x += p.velocityX;
          p.y += p.velocityY;
          p.velocityX *= 0.98; // –ó–∞—Ç—É—Ö–∞–Ω–∏–µ
          p.velocityY *= 0.98;
          p.life -= p.decay;
          p.size *= 0.98;

          if (p.life <= 0) {
            particles.splice(i, 1);
          }
        }
      }

      function drawParticles() {
        particles.forEach((p) => {
          ctx.save();
          ctx.globalAlpha = p.life;
          ctx.fillStyle = p.color;
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
          ctx.fill();
          ctx.restore();
        });
      }

      // ===========================================
      // –§–ò–ó–ò–ö–ê –°–¢–û–õ–ö–ù–û–í–ï–ù–ò–ô
      // ===========================================

      function checkCollision(ball, paddle) {
        return (
          ball.x - ball.radius < paddle.x + paddle.width &&
          ball.x + ball.radius > paddle.x &&
          ball.y - ball.radius < paddle.y + paddle.height &&
          ball.y + ball.radius > paddle.y
        );
      }

      function handlePaddleCollision(paddle) {
        // –í—ã—á–∏—Å–ª—è–µ–º —Ç–æ—á–∫—É —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ü–µ–Ω—Ç—Ä–∞ —Ä–∞–∫–µ—Ç–∫–∏
        const paddleCenter = paddle.y + paddle.height / 2;
        const hitPos = (ball.y - paddleCenter) / (paddle.height / 2);

        // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —É–≥–æ–ª –æ—Ç—Ä–∞–∂–µ–Ω–∏—è
        const angle = hitPos * MAX_ANGLE;

        // –í—ã—á–∏—Å–ª—è–µ–º –Ω–æ–≤—É—é —Å–∫–æ—Ä–æ—Å—Ç—å
        const speed = Math.sqrt(
          ball.velocityX * ball.velocityX + ball.velocityY * ball.velocityY
        );
        const newSpeed = Math.min(speed * 1.05, 12); // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å, –Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º

        ball.velocityX =
          -Math.sign(ball.velocityX) * newSpeed * Math.cos(angle);
        ball.velocityY = newSpeed * Math.sin(angle);

        // –≠—Ñ—Ñ–µ–∫—Ç—ã
        createImpactEffect(ball.x, ball.y);
        playPaddleHitSound();

        // –û—Ç—Ç–∞–ª–∫–∏–≤–∞–µ–º –º—è—á –æ—Ç —Ä–∞–∫–µ—Ç–∫–∏, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –∑–∞–ª–∏–ø–∞–Ω–∏—è
        if (paddle === player) {
          ball.x = paddle.x + paddle.width + ball.radius;
        } else {
          ball.x = paddle.x - ball.radius;
        }
      }

      // ===========================================
      // –ò–ì–†–û–í–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò –°–û–°–¢–û–Ø–ù–ò–ï
      // ===========================================

      let gameState = "start";
      let playerScore = 0;
      let aiScore = 0;
      let currentDifficulty = "easy";
      let gameStartTime = 0;
      let totalHits = 0;
      let isPaused = false;

      // ===========================================
      // –û–°–ù–û–í–ù–û–ô –ò–ì–†–û–í–û–ô –¶–ò–ö–õ
      // ===========================================

      function gameLoop() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        if (gameState === "playing" && !isPaused) {
          // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
          ball.update();
          player.update();
          ai.update();
          updateParticles();

          // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π
          if (checkCollision(ball, player)) {
            handlePaddleCollision(player);
            totalHits++;
          }

          if (checkCollision(ball, ai)) {
            handlePaddleCollision(ai);
            totalHits++;
          }

          // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã
          if (playerScore >= 11 || aiScore >= 11) {
            endGame();
          }
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –≤—Å–µ—Ö –æ–±—ä–µ–∫—Ç–æ–≤
        drawGame();

        requestAnimationFrame(gameLoop);
      }

      // ===========================================
      // –§–£–ù–ö–¶–ò–ò –û–¢–†–ò–°–û–í–ö–ò
      // ===========================================

      function drawGame() {
        // –§–æ–Ω –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è
        ctx.fillStyle = "#1a1a1a";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // –°–µ—Ç–∫–∞ –∏ —Ä–∞–∑–º–µ—Ç–∫–∞
        drawCourt();

        // –ò–≥—Ä–æ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã
        ball.draw();
        player.draw();
        ai.draw();

        // –≠—Ñ—Ñ–µ–∫—Ç—ã
        drawParticles();

        // –ü–∞—É–∑–∞
        if (isPaused) {
          drawPauseScreen();
        }
      }

      function drawCourt() {
        ctx.strokeStyle = "#ECF0F1";
        ctx.lineWidth = 3;

        // –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ª–∏–Ω–∏—è
        ctx.setLineDash([10, 10]);
        ctx.beginPath();
        ctx.moveTo(canvas.width / 2, 0);
        ctx.lineTo(canvas.width / 2, canvas.height);
        ctx.stroke();
        ctx.setLineDash([]);

        // –ì—Ä–∞–Ω–∏—Ü—ã –ø–æ–ª—è
        ctx.strokeRect(0, 0, canvas.width, canvas.height);

        // –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –æ–∫—Ä—É–∂–Ω–æ—Å—Ç—å
        ctx.beginPath();
        ctx.arc(canvas.width / 2, canvas.height / 2, 50, 0, Math.PI * 2);
        ctx.stroke();
      }

      function drawPauseScreen() {
        ctx.fillStyle = "rgba(0, 0, 0, 0.7)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        ctx.fillStyle = "#ECF0F1";
        ctx.font = "bold 48px Arial";
        ctx.textAlign = "center";
        ctx.fillText("–ü–ê–£–ó–ê", canvas.width / 2, canvas.height / 2);

        ctx.font = "20px Arial";
        ctx.fillText(
          "–ù–∞–∂–º–∏—Ç–µ –ü—Ä–æ–±–µ–ª –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è",
          canvas.width / 2,
          canvas.height / 2 + 40
        );
      }

      // ===========================================
      // –£–ü–†–ê–í–õ–ï–ù–ò–ï –ò –°–û–ë–´–¢–ò–Ø
      // ===========================================

      // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º—ã—à—å—é
      canvas.addEventListener("mousemove", function (e) {
        if (gameState === "playing") {
          const rect = canvas.getBoundingClientRect();
          const mouseY = e.clientY - rect.top;
          player.targetY = mouseY - player.height / 2;
        }
      });

      // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π
      document.addEventListener("keydown", function (e) {
        if (e.code === "Space") {
          e.preventDefault();
          if (gameState === "playing") {
            isPaused = !isPaused;
          } else if (gameState === "start") {
            startGame();
          }
        }
      });

      // ===========================================
      // –£–ü–†–ê–í–õ–ï–ù–ò–ï –ò–ì–†–û–ô
      // ===========================================

      function selectDifficulty(difficulty) {
        currentDifficulty = difficulty;
        ai.difficulty = difficulty;

        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
        document.querySelectorAll(".difficulty-btn").forEach((btn) => {
          btn.classList.remove("selected");
        });
        event.target.classList.add("selected");
      }

      function startGame() {
        gameState = "playing";
        gameStartTime = Date.now();
        resetGame();
        document.getElementById("startScreen").style.display = "none";
        document.getElementById("powerUps").style.display = "block";
      }

      function endGame() {
        gameState = "gameOver";
        const isPlayerWin = playerScore > aiScore;
        const gameDuration = Math.round((Date.now() - gameStartTime) / 1000);

        document.getElementById("gameResult").textContent = isPlayerWin
          ? "üèÜ –ü–æ–±–µ–¥–∞!"
          : "üò¢ –ü–æ—Ä–∞–∂–µ–Ω–∏–µ!";
        document.getElementById(
          "finalScore"
        ).textContent = `–§–∏–Ω–∞–ª—å–Ω—ã–π —Å—á—ë—Ç: ${playerScore}-${aiScore}`;
        document.getElementById(
          "gameStats"
        ).innerHTML = `–í—Ä–µ–º—è –∏–≥—Ä—ã: ${gameDuration}—Å | –£–¥–∞—Ä–æ–≤: ${totalHits} | –£—Ä–æ–≤–µ–Ω—å –ò–ò: ${currentDifficulty.toUpperCase()}`;

        document.getElementById("gameOver").style.display = "block";
        document.getElementById("powerUps").style.display = "none";
      }

      function restartGame() {
        resetGame();
        gameState = "playing";
        gameStartTime = Date.now();
        document.getElementById("gameOver").style.display = "none";
        document.getElementById("powerUps").style.display = "block";
      }

      function showStartScreen() {
        gameState = "start";
        resetGame();
        document.getElementById("gameOver").style.display = "none";
        document.getElementById("startScreen").style.display = "block";
        document.getElementById("powerUps").style.display = "none";
      }

      function resetGame() {
        playerScore = 0;
        aiScore = 0;
        totalHits = 0;
        ball.reset();
        player.y = canvas.height / 2 - PADDLE_HEIGHT / 2;
        ai.y = canvas.height / 2 - PADDLE_HEIGHT / 2;
        particles = [];
        isPaused = false;
        updateScore();
      }

      // ===========================================
      // –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
      // ===========================================

      function updateScore() {
        document.getElementById(
          "score"
        ).textContent = `–ò–≥—Ä–æ–∫: ${playerScore} | –ò–ò: ${aiScore}`;

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
        const effects = [];
        if (ball.velocityX > 8 || ball.velocityX < -8)
          effects.push("‚ö° –ë—ã—Å—Ç—Ä—ã–π –º—è—á");
        if (totalHits > 20) effects.push("üî• –ì–æ—Ä—è—á–∞—è —Å–µ—Ä–∏—è");

        document.getElementById("activeEffects").textContent = effects.length
          ? effects.join(", ")
          : "–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤";
      }

      // –ó–≤—É–∫–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã —á–µ—Ä–µ–∑ Web Audio API
      function playHitSound() {
        createBeep(300, 0.1, "square");
      }

      function playPaddleHitSound() {
        createBeep(500, 0.1, "sine");
      }

      function playScoreSound() {
        createBeep(800, 0.3, "triangle");
      }

      function createBeep(frequency, duration, type = "sine") {
        try {
          const audioContext = new (window.AudioContext ||
            window.webkitAudioContext)();
          const oscillator = audioContext.createOscillator();
          const gainNode = audioContext.createGain();

          oscillator.connect(gainNode);
          gainNode.connect(audioContext.destination);

          oscillator.frequency.setValueAtTime(
            frequency,
            audioContext.currentTime
          );
          oscillator.type = type;
          gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(
            0.01,
            audioContext.currentTime + duration
          );

          oscillator.start(audioContext.currentTime);
          oscillator.stop(audioContext.currentTime + duration);
        } catch (e) {
          console.log("–ó–≤—É–∫ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω");
        }
      }

      // ===========================================
      // –ó–ê–ü–£–°–ö –ò–ì–†–´
      // ===========================================

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
      ai.difficulty = currentDifficulty;
      updateScore();

      // –ó–∞–ø—É—Å–∫ –∏–≥—Ä–æ–≤–æ–≥–æ —Ü–∏–∫–ª–∞
      gameLoop();

      // ===========================================
      // –û–ë–£–ß–ê–Æ–©–ò–ï –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ò
      // ===========================================

      /*
        –û–ë–†–ê–ó–û–í–ê–¢–ï–õ–¨–ù–´–ï –ö–û–ù–¶–ï–ü–¶–ò–ò –í –≠–¢–û–ô –ò–ì–†–ï:
        
        1. –í–ï–ö–¢–û–†–ù–ê–Ø –ú–ê–¢–ï–ú–ê–¢–ò–ö–ê - –°–∫–æ—Ä–æ—Å—Ç–∏, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è, —É–≥–ª—ã –æ—Ç—Ä–∞–∂–µ–Ω–∏—è
        2. –§–ò–ó–ò–ö–ê –°–¢–û–õ–ö–ù–û–í–ï–ù–ò–ô - –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π
        3. –ò–ò –†–ê–ó–õ–ò–ß–ù–û–ô –°–õ–û–ñ–ù–û–°–¢–ò - –ê–ª–≥–æ—Ä–∏—Ç–º—ã –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π
        4. –°–ò–°–¢–ï–ú–ê –ß–ê–°–¢–ò–¶ - –í–∏–∑—É–∞–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –∏ –∞–Ω–∏–º–∞—Ü–∏—è
        5. –ò–ì–†–û–í–ê–Ø –õ–û–ì–ò–ö–ê - –°–æ—Å—Ç–æ—è–Ω–∏—è, —Å—á—ë—Ç, –ø—Ä–∞–≤–∏–ª–∞
        6. CANVAS API - –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–µ —Ä–∏—Å–æ–≤–∞–Ω–∏–µ 2D –≥—Ä–∞—Ñ–∏–∫–∏
        7. WEB AUDIO API - –ü—Ä–æ—Ü–µ–¥—É—Ä–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–≤—É–∫–æ–≤
        8. –ü–õ–ê–í–ù–ê–Ø –ê–ù–ò–ú–ê–¶–ò–Ø - –ò–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è –∏ —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏–π
        9. –ü–†–ï–î–°–ö–ê–ó–ê–ù–ò–ï –¢–†–ê–ï–ö–¢–û–†–ò–ò - –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
        10. –£–ü–†–ê–í–õ–ï–ù–ò–ï –°–û–°–¢–û–Ø–ù–ò–Ø–ú–ò - –ü–∞—Ç—Ç–µ—Ä–Ω State Machine
        
        –ê–õ–ì–û–†–ò–¢–ú–´:
        - –†–∞—Å—á—ë—Ç —É–≥–ª–æ–≤ –æ—Ç—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–æ—á–∫–∏ –∫–∞—Å–∞–Ω–∏—è
        - –ò–ò —Å –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ–º —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏ –º—è—á–∞
        - –°–∏—Å—Ç–µ–º–∞ —á–∞—Å—Ç–∏—Ü —Å —Ñ–∏–∑–∏–∫–æ–π –∑–∞—Ç—É—Ö–∞–Ω–∏—è
        - –ü–ª–∞–≤–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ —Ä–∞–∫–µ—Ç–æ–∫ —Å –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–µ–π
        - –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å –∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –∏–≥—Ä—ã
        */
    </script>
  </body>
</html>
